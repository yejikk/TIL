# 함수를 이용해서 코드 정리정돈하기

> 프로그램이 커질수록 코드의 복잡도가 증가한다.
> 따라서 줄일 수 있는 부분은 극도로 줄여야하며, 중복되는 부분은 따로 빼내서 함수화해보자.



* 여러 곳에서 중복되는 코드를 함수로 빼낸다.

  ```javascript
  // 똑같은 코드가 여러개 있는 것을 방지하기 위해 재사용할 수 있는 함수를 만든다.
  function templateHTML(title, list, body) {
    return `
    <!doctype html>
    <html>
    <head>
      <title>WEB1 - ${title}</title>
      <meta charset="utf-8">
    </head>
    <body>
      <h1><a href="/">WEB</a></h1>
      ${list}
      ${body}
    </body>
    </html>
    `;
  };
  ```

  ```javascript
  function templateList(fileList) {
    var list = '<ul>';
    var i = 0;
    while(i < fileList.length) {
      list += `<li><a href="/?id=${fileList[i]}">${fileList[i]}</a></li>`
      i += 1;
    }
    list += '</ul>'
    return list;
  }
  ```

  

* 메인 코드에서는 빼놓은 함수가 받아야되는 값을 넘겨주기만 하면 된다.

  ```javascript
  var template = templateHTML(title, list,
                              `<h2>${title}</h2>${description}`
                             );
  ```

  ```javascript
  var list = templateList(fileList);
  ```





### 이고잉님이 마지막에 해결하지않은 readdir() 메소드의 중복을 없애봤다.

```javascript
var http = require('http');
var fs = require('fs');
var url = require('url');

// 똑같은 코드가 여러개 있는 것을 방지하기 위해 재사용할 수 있는 함수를 만든다.
function templateHTML(title, list, body) {
  return `
  <!doctype html>
  <html>
  <head>
    <title>WEB1 - ${title}</title>
    <meta charset="utf-8">
  </head>
  <body>
    <h1><a href="/">WEB</a></h1>
    ${list}
    ${body}
  </body>
  </html>
  `;
}
function templateList(fileList) {
  var list = '<ul>';
  var i = 0;
  while(i < fileList.length) {
    list += `<li><a href="/?id=${fileList[i]}">${fileList[i]}</a></li>`
    i += 1;
  }
  list += '</ul>'
  return list;
}

var app = http.createServer(function(request,response){
    var _url = request.url;
    var queryData = url.parse(_url, true).query;
    var pathname = url.parse(_url, true).pathname;

    // 1-1. 쿼리 스트링을 통해 페이지를 요청했을 경우
    if (pathname === '/') {
      // 홈 화면이든 상세 페이지든 바로가기 링크는 필요하므로,
      // 일단 fileList를 읽어오고나서 본문 내용을 구성해보자.
      fs.readdir('./data', function(error, fileList) {
        // 2-1. 홈 화면을 요청했을 경우
        if (queryData.id === undefined) {
            var title = 'Welcome';
            var description = 'Hello, Node.js';
            var list = templateList(fileList);
            var template = templateHTML(title, list,
                                        `<h2>${title}</h2>${description}`
                                      );
            response.writeHead(200);
            response.end(template);

        // 2-2. 상세 페이지를 요청했을 경우
        } else {
          fs.readFile(`data/${queryData.id}`, 'utf-8', function(err, description) {
            var title = queryData.id;
            var list = templateList(fileList);
            var template = templateHTML(title, list,
                                        `<h2>${title}</h2>${description}`
                                      );
            response.writeHead(200);
            response.end(template);
          });
        }
      });
    // 1-2. Path Name을 통해 페이지를 요청했을 경우
    } else {
      response.writeHead(404);
      response.end('Not found!');    
    }
});
app.listen(3000);
```







